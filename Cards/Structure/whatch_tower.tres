[gd_resource type="Resource" script_class="Card" load_steps=6 format=3 uid="uid://bu3i7co0jdn5v"]

[ext_resource type="Texture2D" uid="uid://ch1si1ieh5bdk" path="res://Assets/Structures/CardPics/WatchTowerPic.svg" id="1_qmomh"]
[ext_resource type="PackedScene" uid="uid://cdgq1olwif7k5" path="res://Scenes/Models/Structures/LookoutTower.tscn" id="2_6oaxe"]
[ext_resource type="Script" uid="uid://d3h8qkdu4r1na" path="res://Scripts/Predicates/StructurePredicate.gd" id="3_qwl6y"]
[ext_resource type="Script" uid="uid://dtj6f2ym5ac5b" path="res://Scripts/Resources/Card.gd" id="4_ihmug"]

[sub_resource type="GDScript" id="GDScript_5k02a"]
script/source = "extends Structure
class_name watch_tower

var visible_hexes : Array[Vector2i]

func on_play():
	var neighbours = GameManager.board_manager.get_neighbours(x,y)
	conquring_hexes.append(Vector2i(x,y))
	for neighbour : Hex in neighbours:
		var new_neighbours = GameManager.board_manager.get_neighbours(neighbour.coord.x, neighbour.coord.y)
		for new_neighbour : Hex in new_neighbours:
			visible_hexes.append(new_neighbour.coord)
		conquring_hexes.append(neighbour.coord)
	conqure_hexes()

func conqure_hexes():
	var board = GameManager.board_manager
	for coord : Vector2i in conquring_hexes:
		print(coord)
		if not board.conqured_hexes.has(coord):
			board.conqured_hexes[coord] = player
			board.outline.set_hex_coord_outline(\"conqured_hexes\", coord, board.player_colors[player])
			board.fog.reveal_hex(coord.x, coord.y)
	for visible_coord : Vector2i in visible_hexes:
		board.fog.reveal_hex(visible_coord.x, visible_coord.y)
"

[resource]
script = ExtResource("4_ihmug")
name = "Watch Tower"
id = "watch_tower"
type = 2
cost = {
0: 2
}
card_image = ExtResource("1_qmomh")
description = "This is a structure that can see farther than other structures"
health = 5
model = ExtResource("2_6oaxe")
custom_script = SubResource("GDScript_5k02a")
play_predicate = ExtResource("3_qwl6y")
metadata/_custom_type_script = "uid://dtj6f2ym5ac5b"
